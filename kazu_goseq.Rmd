---
title: "kazu_goseq"
output: html_document
---

```{r}
library(goseq)
library(tidyverse)
library(readxl)
```
# read defferencially expressed genes saved in csv file
```{r}
getwd()
DEgene.1h <- read.csv("../output/DEgenes.Col.1h.csv")
head(DEgene.1h)
DEgene.49h <- read.csv("../output/DEgenes.Col.49h.csv")
genes.shade1h.up <- DEgene.1h %>% filter(logFC>0)
genes.shade1h.down <- DEgene.1h %>% filter(logFC<0)
```
#read cpm file for only defferentialy expressed genes at 1h
```{r}
mycpm.1h <- read.csv("../output/DEgenecpm.1h.csv")
mycpm.1h
```

#read description

```{r}
Description <- read.delim("../reference/gene_aliases_20180702.txt")
#merge the gene with different names together to let the names be like name1;name2;...
Description.merge <- aggregate(Description[,2], list(Description[,1]), function(x) paste0(unique(x),collapse = ";"))
colnames(Description.merge) <- c("ID", "name")

```


#plot genes up and down regulated at 1h in Col

```{r}
#only leave the gene id and sample_id column
genes.shade1h.up %>% left_join(mycpm.1h,by="X") %>% dplyr::select(1, starts_with("Col")) -> plot.data1 
#remove the .1 in the gene name
plot.data1[,1] <- gsub("\\.\\d", "",plot.data1$X)
#merge gene id with gene name
plot.data1 <- plot.data1 %>% left_join(Description.merge, by=c("X"="ID")) %>%  unite(AGI_desc,c("X","name"))
p1<-plot.data1 %>% gather(sample,value,-1) %>% separate(sample,c("genotype","time_hr","trt","rep"),sep="_") %>%
ggplot(aes(x=trt,y=value,color=trt,shape=time_hr))  + geom_violin() + geom_jitter() + facet_wrap(~AGI_desc,scale="free",labeller = label_wrap_gen(width=30),ncol=3)+theme(strip.text = element_text(size=6))
p1
ggsave(p1, file = "../output/shade1h.up.Col.pdf", height = 20, units = "in")
```

```{r}
genes.shade1h.down %>% left_join(mycpm.1h,by="X") %>% dplyr::select(1, starts_with("Col")) -> plot.data 
# plot: use labeller = label_wrap_gen(width=10) for multiple line in each gene name
plot.data[,1] <- gsub("\\.\\d", "",plot.data$X)
plot.data <- plot.data %>% left_join(Description.merge, by=c("X"="ID")) %>%  unite(AGI_desc,c("X","name"))
p<-plot.data %>% gather(sample,value,-1) %>% separate(sample,c("genotype","time_hr","trt","rep"),sep="_") %>%
ggplot(aes(x=trt,y=value,color=trt,shape=time_hr))  + geom_violin() + geom_jitter() + facet_wrap(~AGI_desc,scale="free",labeller = label_wrap_gen(width=30),ncol=3)+theme(strip.text = element_text(size=6))
p
ggsave(p, file = "../output/shade1h.down.Col.pdf", height = 20, units = "in")
```

# plot the known up regulated genes at 1h shade treatment from my data
#PIL1 ATHB2 IAA19 IAA29 SAUR YUCCA9

```{r}
#read data about all the genes expressed at 1h
cpm.Col.1h <- read.csv("../output/cpm.Col.1h.csv")

genes.Col.1h <- read.csv("../output/genes.Col.1h.csv")
```


```{r}
#only leave the gene id and sample_id column
genes.Col.1h %>% left_join(cpm.Col.1h,by="X") %>% dplyr::select(1, starts_with("Col")) -> plot.data3 
#remove the .1 in the gene name
plot.data3[,1] <- gsub("\\.\\d", "",plot.data3$X)
#merge gene id with gene name
plot.data3 <- plot.data3 %>% left_join(Description.merge, by=c("X"="ID")) %>%  unite(AGI_desc,c("X","name"))
#extract PIL1 ATHB2 IAA19 IAA29 SAUR YUCCA9 genes from plot.data3

plot.data3 <- plot.data3 %>% filter(str_detect(AGI_desc, regex("PIL1|ATHB2|IAA19|IAA29|SAUR|YUCCA")))

p3<-plot.data3 %>% gather(sample,value,-1) %>% separate(sample,c("genotype","time_hr","trt","rep"),sep="_") %>%
ggplot(aes(x=trt,y=value,color=trt,shape=time_hr))  + geom_violin() + geom_jitter() + facet_wrap(~AGI_desc,scale="free",labeller = label_wrap_gen(width=30),ncol=3)+theme(strip.text = element_text(size=6))
p3
ggsave(p3, file = "../output/known_shade_up_Col_1h.pdf", height = 20, units = "in")
```

